#WNDR4300 编译固件的方法

按官网的方法，以下操作，没用sudo的地方，均*不要使用root。*

###1. 方法1

```markdown

Ref to [opewrt wiki](https://wiki.openwrt.org/doc/howto/build)

 1.1 系统准备：
 
  sudo apt-get update

  sudo apt-get install git-core build-essential libssl-dev libncurses5-dev unzip
 
  部分文件可能要用到svc 或是 mercurial
  
  sudo apt-get install subversion mercurial

1.2 下载源文件

   git clone git://git.openwrt.org/openwrt.git
   
   克隆完后，系统创建了operwrt文件夹
 
 将下载的文件的所有者改为自己,我的用户名是ubuntu
 
 sudo chown -Rv ubuntu  /home/ubuntu/openwrt
 

```

2. 方法2 

请参考：[Openwrt编译准备及方法](https://wiki.openwrt.org/zh-tw/doc/howto/buildroot.exigence)</br>

具体过程

 安裝 subversion (short: svn), 來下載OpenWrt的原始碼較為便利，且安裝 build tools 來幫助編彙程序:

sudo apt-get update

sudo apt-get install subversion build-essential

    subversion請參見 svn 和 subversion documentation (multiple languages)
    建置工具請參見 make 和 build-essential

使用svn下載OpenWrt的原始碼

mkdir ~/openwrt

cd ~/openwrt

svn co svn://svn.openwrt.org/openwrt/trunk/

cd trunk


    這會產生 'trunk'資料夾，為OpenWrt原始碼主要的資料夾。

使用feeds script下載並安裝 feeds。(用其他方法作feeds update时，会遇到)

./scripts/feeds update -a
./scripts/feeds install -a


使用以下其中一個命令，可以檢查是否你的建置OpenWrt的環境中有遺漏的套件:

make prereq

make defconfig

make menuconfig

将配置save一下。

如果你想加入你之前预置好的配置文件，那么：

创建files目录，存放预置的配置文件.

mkdir files

cd files

git clone https://github.com/softwaredownload/openwrt-fanqiang

如果你想把某些檔案放到映像檔中的/etc/config資料夾，就把這些檔案放到 /openwrt/trunk//files/etc/config. 

准备就绪后，开始编译：
sudo make


*错误处理：*
```markdown
1. Build dependency: Please install the openssl library (with development headers)
    
  For Centos 

      yum install openssl-devel fixes this.

  For Ubuntu 
    sudo apt-get install libssl-dev fixes this.
  
2. Unable to open feeds configuration in line 42

按本文方法不会遇到这个问题，使用git clone后，做./scripts/feeds update -a会遇到。原因不懂。

3.  configure: error: you should not run configure as root (set FORCE_UNSAFE_CONFIGURE=1 in environment to bypass this check)
See `config.log' for more details

运行：set FORCE_UNSAFE_CONFIGURE=1 再继续编译 




```


</br>
sudo make image PROFILE=WNDR4300 PACKAGES="base-files busybox dnsmasq dropbear firewall fstools jsonfilter libc libgcc mtd netifd opkg procd swconfig ubox ubus ubusd uci kmod-crypto-aes kmod-crypto-arc4 kmod-crypto-core kmod-ledtrig-usbdev kmod-lib-crc-ccitt kmod-nls-base kmod-ip6tables kmod-ipt-conntrack kmod-ipt-core kmod-ipt-nat kmod-ipt-nathelper kmod-ipv6 kmod-ppp kmod-pppoe kmod-pppox kmod-slhc kmod-gpio-button-hotplug kmod-usb-core kmod-usb-ohci kmod-usb2 kmod-ath kmod-ath9k kmod-ath9k-common kmod-cfg80211 kmod-mac80211 libip4tc libip6tc libxtables libblobmsg-json libiwinfo libjson-c libnl-tiny libubox libubus libuci ip6tables iptables hostapd-common iw odhcp6c odhcpd ppp ppp-mod-pppoe wpad-mini iwinfo jshn libjson-script uboot-envtools ipset wget  luci-ssl" FILES=./openwrt
